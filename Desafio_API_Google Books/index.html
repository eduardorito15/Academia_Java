<!doctype html>
<html lang="pt">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Desafio API Google Books</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-LN+7fdVzj6u52u30Kp6M/trliBMCMKTyK833zpbD+pXdCLuTusPj697FH4R/5mcr" crossorigin="anonymous">
</head>

<body>
  <div class="container mt-5">
    <h1 class="text-center mb-4">Desafio API Google Books</h1>
    <div id="bookDisplay"></div>
    <div id="controlsLike" class="text-center">
      <button id="btnLike" class="btn btn-primary">üëç Gosto</button>
      <button id="btnDislike" class="btn btn-danger">üëé N√£o gosto</button>
    </div>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-ndDqU0Gzau9qJ1lfW4pNLlhNTkCfHzAVBReH9diLvGRem5+R9g2FzA8ZGN954O5Q"
    crossorigin="anonymous"></script>
  <script src="dataModels.js"></script>

  <script>
    // inicializar vari√°veis
    let queryIndex = 0;
    const books = [];

    // get books from Google Books API and create book elements through Book class
    async function getBooksFromGoogle(search) {
      const url = `https://www.googleapis.com/books/v1/volumes?q=${search}&startIndex=${queryIndex}`;
      const response = await fetch(url);
      queryIndex += 10;
      // console.log(response);
      if (response.ok) {
        const dataFromGoogle = await response.json();
        return dataFromGoogle.items.map(item => new Book(
          item.id,
          item.volumeInfo.title,
          item.volumeInfo.authors,
          item.volumeInfo.publisher,
          item.volumeInfo.publishedDate,
          item.volumeInfo.description,
          item.volumeInfo.pageCount,
          item.volumeInfo.categories,
          item.volumeInfo.imageLinks?.thumbnail,
          item.volumeInfo.language,
          item.volumeInfo.infoLink
        ));
      }
    }


    // apresentar os livros
    let currentIndex = 0;
    async function mostrarLivros(index) {
      // console.log(books);
      const bookDisplay = document.getElementById('bookDisplay');
      bookDisplay.innerHTML = ''; // Limpa o conte√∫do anterior
      if (index >= books.length - 2 || index === 0) {
        // console.log('Fui buscar mais livros');
        const newBooks = await getBooksFromGoogle('JavaScript');
        newBooks.forEach((e) => {
          books.push(e);
        });
      }
      const bookElement = books[index].render();
      bookDisplay.appendChild(bookElement);
    }

    // comportamento dos bot√µes
    document.getElementById('btnLike').addEventListener('click', () => {
      // TODO: guardar em livros que gosta
      currentIndex++;
      mostrarLivros(currentIndex);
    });
    document.getElementById('btnDislike').addEventListener('click', () => {
      // TODO: guardar em livros que n√£o gosta
      currentIndex++;
      mostrarLivros(currentIndex);
    });

    // Iniciar a exibi√ß√£o dos livros
    mostrarLivros(currentIndex);

  </script>
</body>

</html>